$(document).ready(function(){var t,e,n,r,a,l,s,c,i,o,u,d,p,g,f,x,h,k,m,y,A,v,w,B,b,P,z,S,I,O,$,j,q,C,D,E,F,G,H,J,K,L;for(t=[["連任人數","第二屆","第三屆","第四屆","第五屆","第六屆","第七屆"],["25~29","0","0","1","2","1","1"],["30~34","1","3","5","5","2","3"],["35~39","23","14","16","7","7","2"],["40~44","14","18","22","28","6","4"],["45~49","11","19","17","32","20","6"],["50~54","14","11","16","19","13","14"],["55~59","7","7","8","8","8","10"],["60~64","0","0","3","3","2","3"],["65~69","0","0","0","1","0","0"]],e=[["連任比例","第二屆","第三屆","第四屆","第五屆","第六屆","第七屆"],["25~29","0.00","0.00","0.50","1.00","1.00","1.00"],["30~34","0.20","0.75","0.83","0.56","0.22","0.75"],["35~39","0.92","0.67","0.76","0.44","0.41","0.50"],["40~44","0.45","0.56","0.54","0.68","0.26","0.57"],["45~49","0.55","0.61","0.44","0.67","0.38","0.50"],["50~54","0.64","0.48","0.46","0.59","0.36","0.64"],["55~59","0.50","0.50","0.38","0.57","0.30","0.63"],["60~64","0.00","0.00","0.33","0.30","0.22","0.30"],["65~69","0.00","0.00","0.00","0.25","0.00","0.00"]],n=[],r=1,a=e.length;a>r;++r)for(l=r,s=1,c=e[0].length;c>s;++s)i=s,n.push({age:e[l][0],session:e[0][i],count:+e[l][i],ppl:+t[l][i]});return o=[600,600,75,45],u=o[0],d=o[1],p=o[2],g=o[3],f=d3.select("#svg"),o=["age","session"].map(function(t){return d3.map(n,function(e){return e[t]}).keys()}),x=o[0],h=o[1],k=h.concat(["第八屆"]),m=n.map(function(t){return+t.count||0}),console.log(d3.extent(m)),y=d3.scale.ordinal().domain(h).rangeBands([p,u-2*p]),A=d3.scale.ordinal().domain(k).rangePoints([p,u-2*p]),v=d3.scale.ordinal().domain(x).rangeBands([d-g,g]),w=d3.scale.linear().domain(d3.extent(m)).range([g+25,100+g+25]),B=d3.scale.linear().domain(d3.extent(m)).range([0,40]),b=d3.scale.linear().domain([0,1]).range([0,1]),P=d3.svg.axis().scale(A).tickSize([1]).tickPadding(10),z=d3.svg.axis().scale(v).orient("left").tickSize([0]).tickPadding(10),S=y.rangeBand(),I=v.rangeBand(),O=f.selectAll("rect.point").data(n),$=O.enter(),$.append("rect").attr({"class":"point"}),j=f.append("g"),j.call(z),j.attr({"class":"y-axis",transform:"translate("+p+",0)"}),q=f.append("g"),q.call(P),q.attr({"class":"x-axis",transform:"translate(0,"+(d-g)+")"}),C=f.selectAll("line.align").data(k),D=C.enter(),D.append("line").attr({"class":"align"}),E=f.selectAll("circle.align").data(k),F=E.enter(),F.append("circle").attr({"class":"align"}),f.append("line").attr({"class":"top"}),G=f.selectAll("rect.legend").data(b.ticks(5)),H=G.enter(),H.append("rect").attr({"class":"legend"}),J=f.selectAll("text.legend").data(b.ticks(5)),K=J.enter(),K.append("text").attr({"class":"legend"}),f.append("text").attr({"class":"legend-title"}),f.append("line").attr({"class":"sep"}),(L=function(){var t;return f.select("g#popup").attr({transform:"translate("+(u-p+5)+","+(g+170)+")"}),t="零一二三四五六七八九",f.selectAll("rect.point").attr({x:function(t){return 1+y(t.session)},y:function(t){return 1+v(t.age)},width:S-2,height:I-2,fill:function(t){return"rgba(247,20,103,"+b(t.count)+")"},stroke:"#fff","stroke-width":"1"}).on("mouseover",function(n){var r;return r=e[0].indexOf(n.session)+1,d3.select(this).attr({stroke:"#4a4a4a"}),d3.select("g#popup text.session").text(function(){return"第"+t.charAt(r)+"至"+t.charAt(r+1)+"屆"}),d3.select("g#popup text.age").text(n.age+"歲"),d3.select("g#popup text.count").text((n.count>0?"+":"")+""+parseInt(100*n.count)+"%"),d3.select("g#popup text.ppl").text("共"+n.ppl+"人 (第"+t.charAt(r)+"屆)")}).on("mouseout",function(){return d3.select(this).attr({stroke:"#fff"})}),f.selectAll("line.align").attr({x1:function(t){return A(t)},x2:function(t){return A(t)},y1:function(){return g},y2:function(){return d-g},stroke:"#444","stroke-width":1}),f.selectAll("circle.align").attr({cx:function(t){return A(t)},cy:function(){return d-g},r:3,fill:"#fff",stroke:"#444","stroke-width":1}),f.select("line.top").attr({x1:function(){return p},x2:function(){return u-2*p},y1:g,y2:g,stroke:"#444"}),f.selectAll("rect.legend").attr({x:function(){return u-1.5*p},y:function(t){return w(t)},width:function(){return p/2},height:10,fill:function(t){return"rgba(247,20,103,"+b(t)+")"},stroke:"#444","stroke-width":1}),f.selectAll("text.legend").attr({x:function(){return u-p+45},y:function(t){return w(t)},dy:10,"text-anchor":"end"}).text(function(t){return 0>=t?100*t+"%":"+"+100*t+"%"}),f.select("text.legend-title").attr({x:function(){return u-p-35},y:function(){return g},"dominant-baseline":"hanging"}).text("連任人數變化"),f.select("line.sep").attr({x1:u-1.5*p,x2:u-p+45,y1:g+150,y2:g+150,stroke:"#444"})})()});