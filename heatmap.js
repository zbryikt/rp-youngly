$(document).ready(function(){var t,e,n,r,a,l,c,s,i,o,u,d,f,g,p,x,k,h,m,y,A,v,w,b,B,P,z,S,I,O,$,j,q,C,D,E,F,G,H,J,K;for(t=[["連任比例","第二屆","第三屆","第四屆","第五屆","第六屆","第七屆"],["25~29","-0.55","-0.55","-0.05","0.45","0.45","0.45"],["30~34","-0.35","0.20","0.28","0.01","-0.33","0.20"],["35~39","0.30","0.05","0.14","-0.18","-0.21","-0.12"],["40~44","-0.06","0.05","0.03","0.17","-0.25","0.06"],["45~49","0.02","0.08","-0.09","0.14","-0.15","-0.03"],["50~54","0.11","-0.05","-0.07","0.06","-0.17","0.11"],["55~59","0.02","0.02","-0.10","0.09","-0.18","0.15"],["60~64","0.19","0.00","-0.33","-0.30","-0.22","-0.30"],["65~69","0.00","0.00","0.00","-0.25","0.00","0.00"]],e=[],n=1,r=t.length;r>n;++n)for(a=n,l=1,c=t[0].length;c>l;++l)s=l,e.push({age:t[a][0],session:t[0][s],count:+t[a][s]});return i=[600,600,75,45],o=i[0],u=i[1],d=i[2],f=i[3],g=d3.select("#svg"),i=["age","session"].map(function(t){return d3.map(e,function(e){return e[t]}).keys()}),p=i[0],x=i[1],k=x.concat(["第八屆"]),h=e.map(function(t){return+t.count||0}),console.log(d3.extent(h)),m=d3.scale.ordinal().domain(x).rangeBands([d,o-2*d]),y=d3.scale.ordinal().domain(k).rangePoints([d,o-2*d]),A=d3.scale.ordinal().domain(p).rangeBands([u-f,f]),v=d3.scale.linear().domain(d3.extent(h)).range([f,100+f]),w=d3.scale.linear().domain(d3.extent(h)).range([0,40]),b=d3.scale.linear().domain([d3.min(h),0,d3.max(h)]).range([1,0,1]),B=d3.svg.axis().scale(y).tickSize([1]).tickPadding(10),P=d3.svg.axis().scale(A).orient("left").tickSize([0]).tickPadding(10),z=m.rangeBand(),S=A.rangeBand(),I=g.selectAll("rect.point").data(e),O=I.enter(),O.append("rect").attr({"class":"point"}),$=g.append("g"),$.call(P),$.attr({"class":"y-axis",transform:"translate("+d+",0)"}),j=g.append("g"),j.call(B),j.attr({"class":"x-axis",transform:"translate(0,"+(u-f)+")"}),q=g.selectAll("line.align").data(k),C=q.enter(),C.append("line").attr({"class":"align"}),D=g.selectAll("circle.align").data(k),E=D.enter(),E.append("circle").attr({"class":"align"}),g.append("line").attr({"class":"top"}),F=g.selectAll("rect.legend").data(b.ticks(5)),G=F.enter(),G.append("rect").attr({"class":"legend"}),H=g.selectAll("text.legend").data(b.ticks(5)),J=H.enter(),J.append("text").attr({"class":"legend"}),g.append("text").attr({"class":"legend-title"}),g.append("line").attr({"class":"sep"}),(K=function(){return g.select("g#popup").attr({transform:"translate("+(o-d+5)+","+(f+140)+")"}),g.selectAll("rect.point").attr({x:function(t){return 1+m(t.session)},y:function(t){return 1+A(t.age)},width:z-2,height:S-2,fill:function(t){return t.count<0?"rgba(255,68,34,"+b(t.count)+")":"rgba(102,240,34,"+b(t.count)+")"},stroke:"#fff","stroke-width":"1"}).on("mouseover",function(e){return d3.select(this).attr({stroke:"#4a4a4a"}),d3.select("g#popup text.session").text(function(){var n,r;return n="零一二三四五六七八九",r=t[0].indexOf(e.session)+1,"第"+n.charAt(r)+"至"+n.charAt(r+1)+"屆"}),d3.select("g#popup text.age").text(e.age+"歲"),d3.select("g#popup text.count").text((e.count>0?"+":"")+""+parseInt(100*e.count)+"%")}).on("mouseout",function(){return d3.select(this).attr({stroke:"#fff"})}),g.selectAll("line.align").attr({x1:function(t){return y(t)},x2:function(t){return y(t)},y1:function(){return f},y2:function(){return u-f},stroke:"#888","stroke-width":1}),g.selectAll("circle.align").attr({cx:function(t){return y(t)},cy:function(){return u-f},r:3,fill:"#fff",stroke:"#888","stroke-width":1}),g.select("line.top").attr({x1:function(){return d},x2:function(){return o-2*d},y1:f,y2:f,stroke:"#888"}),g.selectAll("rect.legend").attr({x:function(){return o-1.5*d},y:function(t){return v(t)},width:function(){return d/2},height:10,fill:function(t){return 0>t?"rgba(255,68,34,"+b(t)+")":"rgba(102,240,34,"+b(t)+")"},stroke:"#444","stroke-width":1}),g.selectAll("text.legend").attr({x:function(){return o-d+45},y:function(t){return v(t)},dy:10,"text-anchor":"end"}).text(function(t){return 0>=t?100*t+"%":"+"+100*t+"%"}),g.select("text.legend-title").attr({x:function(){return o-d-35},y:function(){return f}}).text("連任人數變化"),g.select("line.sep").attr({x1:o-1.5*d,x2:o-d+45,y1:f+120,y2:f+120,stroke:"#888"})})()});